<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HomePi</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=Playfair+Display:wght@400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0f0f14;
    --surface: #1a1a24;
    --surface2: #22222f;
    --border: rgba(255,255,255,0.07);
    --text: #e8e8f0;
    --muted: #6b6b80;
    --accent: #f0a500;
    --accent2: #4fc3f7;
    --green: #69db7c;
    --red: #ff6b6b;
    --shadow: rgba(0,0,0,0.4);
  }

  body {
    background: #07070d;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    font-family: 'DM Sans', sans-serif;
    color: var(--text);
  }

  .tablet {
    width: 820px;
    height: 580px;
    background: #1c1c22;
    border-radius: 28px;
    box-shadow:
      0 0 0 2px #2a2a38,
      0 0 0 6px #111118,
      0 40px 120px rgba(0,0,0,0.8),
      inset 0 1px 0 rgba(255,255,255,0.06);
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .statusbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 24px 6px;
    font-size: 12px;
    color: var(--muted);
    background: var(--bg);
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
  }

  .statusbar .time { font-family: 'Playfair Display', serif; font-size: 15px; color: var(--text); }
  .statusbar .icons { display: flex; gap: 10px; align-items: center; font-size: 11px; }

  .connection-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: var(--muted);
    transition: background 0.4s;
  }
  .connection-dot.connected { background: var(--green); box-shadow: 0 0 6px var(--green); }

  .app {
    display: grid;
    grid-template-columns: 180px 1fr;
    flex: 1;
    overflow: hidden;
    background: var(--bg);
  }

  .sidebar {
    background: var(--surface);
    border-right: 1px solid var(--border);
    padding: 20px 0;
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .home-label {
    padding: 0 18px 14px;
    font-family: 'Playfair Display', serif;
    font-size: 16px;
    color: var(--text);
    border-bottom: 1px solid var(--border);
    margin-bottom: 8px;
  }

  .home-label small { display: block; font-family: 'DM Sans', sans-serif; font-size: 10px; color: var(--muted); margin-top: 2px; }

  .nav-item {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 18px; font-size: 13px; color: var(--muted);
    cursor: pointer; margin: 0 8px; border-radius: 10px; transition: all 0.2s;
  }

  .nav-item.active { background: rgba(240,165,0,0.12); color: var(--accent); }
  .nav-item:hover:not(.active) { background: var(--surface2); color: var(--text); }

  .sidebar-bottom { margin-top: auto; padding: 14px 16px; border-top: 1px solid var(--border); }

  .api-status { background: var(--surface2); border-radius: 12px; padding: 12px; font-size: 11px; }
  .api-status .status-row { display: flex; align-items: center; gap: 6px; color: var(--muted); }
  .api-status .status-row.ok { color: var(--green); }
  .api-status .status-row.err { color: var(--red); }

  .main {
    padding: 20px; overflow-y: auto;
    display: flex; flex-direction: column; gap: 16px;
  }

  .main::-webkit-scrollbar { width: 4px; }
  .main::-webkit-scrollbar-thumb { background: var(--surface2); border-radius: 4px; }

  .section-title { font-size: 11px; text-transform: uppercase; letter-spacing: 0.12em; color: var(--muted); margin-bottom: 10px; }

  .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }

  .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; padding: 14px; }
  .stat-card .label { font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 6px; }
  .stat-card .value { font-size: 22px; font-family: 'Playfair Display', serif; color: var(--text); line-height: 1; }
  .stat-card .value span { font-size: 11px; font-family: 'DM Sans', sans-serif; color: var(--muted); margin-left: 2px; }
  .stat-card .dot { width: 6px; height: 6px; border-radius: 50%; margin-top: 6px; }

  .scenes { display: flex; gap: 8px; flex-wrap: wrap; }

  .scene-btn {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 20px; padding: 6px 14px; font-size: 11px;
    color: var(--muted); cursor: pointer; font-family: 'DM Sans', sans-serif; transition: all 0.2s;
  }

  .scene-btn.active { background: rgba(240,165,0,0.15); border-color: rgba(240,165,0,0.3); color: var(--accent); }
  .scene-btn:hover:not(.active) { color: var(--text); border-color: rgba(255,255,255,0.14); }

  /* Lights */
  .lights-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }

  .light-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 14px; padding: 14px; cursor: pointer;
    transition: all 0.25s; position: relative; overflow: hidden; user-select: none;
  }

  .light-card::before {
    content: ''; position: absolute; inset: 0; opacity: 0;
    transition: opacity 0.25s; border-radius: 14px;
    background: radial-gradient(circle at top right, rgba(240,200,80,0.12), transparent 70%);
  }

  .light-card.on::before { opacity: 1; }
  .light-card:hover { border-color: rgba(255,255,255,0.14); transform: translateY(-1px); }
  .light-card.loading { opacity: 0.6; pointer-events: none; }

  .light-icon { font-size: 22px; margin-bottom: 10px; display: block; filter: grayscale(1) opacity(0.4); transition: filter 0.3s; }
  .light-card.on .light-icon { filter: none; }
  .light-card .room { font-size: 12px; font-weight: 500; color: var(--text); margin-bottom: 2px; }
  .light-card .status { font-size: 10px; color: var(--muted); }
  .light-card.on .status { color: var(--accent); }

  /* Color swatch on card */
  .light-color-dot {
    position: absolute; top: 12px; right: 12px;
    width: 16px; height: 16px; border-radius: 50%;
    border: 2px solid rgba(255,255,255,0.15);
    transition: all 0.3s;
  }

  /* Controls panel below lights */
  .light-controls {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 14px 16px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .controls-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .controls-header .label { font-size: 11px; font-weight: 600; color: var(--text); }
  .controls-header .selected-light { font-size: 10px; color: var(--accent); font-weight: 500; }

  .slider-row {
    display: flex; align-items: center; gap: 10px;
    font-size: 11px; color: var(--muted);
  }

  .slider {
    flex: 1; -webkit-appearance: none;
    height: 4px; border-radius: 2px; cursor: pointer;
  }

  .slider::-webkit-slider-thumb {
    -webkit-appearance: none; width: 12px; height: 12px;
    background: var(--accent); border-radius: 50%;
    box-shadow: 0 0 8px rgba(240,165,0,0.5);
  }

  /* Color swatches */
  .color-row {
    display: flex; align-items: center; gap: 8px;
  }

  .color-row .label { font-size: 10px; color: var(--muted); min-width: 60px; }

  .color-swatches {
    display: flex; gap: 6px; flex-wrap: wrap;
  }

  .swatch {
    width: 20px; height: 20px; border-radius: 50%;
    cursor: pointer; border: 2px solid transparent;
    transition: all 0.2s; flex-shrink: 0;
  }

  .swatch:hover { transform: scale(1.2); }
  .swatch.active { border-color: white; transform: scale(1.15); }

  /* Custom colour input */
  .color-input-wrap {
    display: flex; align-items: center; gap: 8px; margin-left: auto;
  }

  .color-input-wrap label { font-size: 10px; color: var(--muted); }

  input[type="color"] {
    -webkit-appearance: none; appearance: none;
    width: 28px; height: 28px; border: none;
    border-radius: 50%; cursor: pointer;
    background: none; padding: 0;
    overflow: hidden;
  }

  input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
  input[type="color"]::-webkit-color-swatch { border: 2px solid rgba(255,255,255,0.2); border-radius: 50%; }

  /* Bottom row */
  .bottom-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

  .device-card { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; padding: 16px; }
  .device-card h4 { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 12px; }

  .device-item {
    display: flex; align-items: center; justify-content: space-between;
    padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 12px;
  }
  .device-item:last-child { border-bottom: none; padding-bottom: 0; }
  .device-item .name { color: var(--text); display: flex; align-items: center; gap: 8px; }

  .badge { font-size: 9px; padding: 2px 7px; border-radius: 20px; font-weight: 500; }
  .badge.on { background: rgba(105,219,124,0.15); color: var(--green); }
  .badge.off { background: rgba(107,107,128,0.15); color: var(--muted); }
  .badge.alert { background: rgba(255,107,107,0.15); color: var(--red); }

  .light-card { animation: fadeUp 0.4s ease both; }
  .light-card:nth-child(1) { animation-delay: 0.05s; }
  .light-card:nth-child(2) { animation-delay: 0.1s; }
  .light-card:nth-child(3) { animation-delay: 0.15s; }
  .light-card:nth-child(4) { animation-delay: 0.2s; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>

<div class="tablet">
  <div class="statusbar">
    <div class="time" id="clock">00:00</div>
    <div class="icons">
      <div class="connection-dot" id="connDot"></div>
      <span id="connLabel">Connecting...</span>
      <span>üîã 100%</span>
    </div>
  </div>

  <div class="app">
    <div class="sidebar">
      <div class="home-label">
        HomePi
        <small id="activeCount">Loading...</small>
      </div>
      <div class="nav-item active"><span>‚ö°</span> Dashboard</div>
      <div class="nav-item"><span>üí°</span> Lighting</div>
      <div class="nav-item"><span>üå°</span> Climate</div>
      <div class="nav-item"><span>üîí</span> Security</div>
      <div class="nav-item"><span>üéµ</span> Media</div>
      <div class="nav-item"><span>‚öôÔ∏è</span> Automations</div>
      <div class="nav-item" onclick="window.location.href='/devices.html'" style="cursor:pointer"><span>üì°</span> Devices</div>
      <div class="sidebar-bottom">
        <div class="api-status">
          <div class="status-row" id="apiStatusRow">
            <span>‚óè</span> <span id="apiStatusText">Connecting...</span>
          </div>
        </div>
      </div>
    </div>

    <div class="main">

      <!-- Stats -->
      <div>
        <div class="section-title">Overview</div>
        <div class="stats-row">
          <div class="stat-card">
            <div class="label">Active lights</div>
            <div class="value" id="statActive">‚Äî<span></span></div>
            <div class="dot" style="background: var(--green)"></div>
          </div>
          <div class="stat-card">
            <div class="label">Brightness</div>
            <div class="value" id="statBrightness">‚Äî<span>%</span></div>
            <div class="dot" style="background: var(--accent2)"></div>
          </div>
          <div class="stat-card">
            <div class="label">Devices total</div>
            <div class="value" id="statTotal">‚Äî<span></span></div>
            <div class="dot" style="background: var(--accent)"></div>
          </div>
          <div class="stat-card">
            <div class="label">API status</div>
            <div class="value" id="statApi" style="font-size:14px">‚Äî</div>
            <div class="dot" style="background: var(--green)"></div>
          </div>
        </div>
      </div>

      <!-- Scenes -->
      <div>
        <div class="section-title">Scene</div>
        <div class="scenes">
          <div class="scene-btn active">üåÖ Morning</div>
          <div class="scene-btn">‚òÄÔ∏è Day</div>
          <div class="scene-btn">üé¨ Movie</div>
          <div class="scene-btn">üåô Evening</div>
          <div class="scene-btn">üí§ Sleep</div>
          <div class="scene-btn">üéâ Party</div>
        </div>
      </div>

      <!-- Lights -->
      <div>
        <div class="section-title">Lights</div>
        <div class="lights-grid" id="lightsGrid"></div>

        <!-- Controls panel -->
        <div class="light-controls" style="margin-top: 10px">
          <div class="controls-header">
            <div class="label">‚òÄÔ∏è Brightness</div>
            <div class="selected-light" id="selectedLightLabel">All lights</div>
          </div>
          <div class="slider-row">
            <span>üåë</span>
            <input type="range" class="slider" id="brightnessSlider" value="100" min="1" max="100"
              style="background: linear-gradient(to right, var(--accent) 100%, var(--surface2) 100%)">
            <span>‚òÄÔ∏è</span>
            <span id="brightnessVal" style="min-width: 28px; color: var(--text)">100%</span>
          </div>

          <div class="color-row">
            <div class="label">üé® Colour</div>
            <div class="color-swatches" id="colorSwatches">
              <div class="swatch" style="background:#ffffff" data-r="255" data-g="255" data-b="255" title="White"></div>
              <div class="swatch" style="background:#ffd27a" data-r="255" data-g="200" data-b="80" title="Warm"></div>
              <div class="swatch" style="background:#ff6b6b" data-r="255" data-g="60" data-b="60" title="Red"></div>
              <div class="swatch" style="background:#ff9500" data-r="255" data-g="149" data-b="0" title="Orange"></div>
              <div class="swatch" style="background:#ffd60a" data-r="255" data-g="214" data-b="10" title="Yellow"></div>
              <div class="swatch" style="background:#69db7c" data-r="80" data-g="200" data-b="100" title="Green"></div>
              <div class="swatch" style="background:#4fc3f7" data-r="40" data-g="180" data-b="240" title="Blue"></div>
              <div class="swatch" style="background:#c084fc" data-r="180" data-g="80" data-b="240" title="Purple"></div>
              <div class="swatch" style="background:#f472b6" data-r="240" data-g="80" data-b="160" title="Pink"></div>
            </div>
            <div class="color-input-wrap">
              <label>Custom</label>
              <input type="color" id="customColor" value="#ffffff" title="Pick a colour">
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom row -->
      <div class="bottom-row">
        <div class="device-card">
          <h4>Devices</h4>
          <div class="device-item"><div class="name"><span>üå°</span> Thermostat</div><span class="badge off">‚Äì</span></div>
          <div class="device-item"><div class="name"><span>üì∫</span> Living Room TV</div><span class="badge off">‚Äì</span></div>
          <div class="device-item"><div class="name"><span>ü´ß</span> Dishwasher</div><span class="badge off">‚Äì</span></div>
          <div class="device-item"><div class="name"><span>üåÄ</span> Robot Vacuum</div><span class="badge off">‚Äì</span></div>
        </div>
        <div class="device-card">
          <h4>Security</h4>
          <div class="device-item"><div class="name"><span>üö™</span> Front Door</div><span class="badge on">Locked</span></div>
          <div class="device-item"><div class="name"><span>ü™ü</span> Back Window</div><span class="badge alert">Open</span></div>
          <div class="device-item"><div class="name"><span>üì∑</span> Doorbell Cam</div><span class="badge on">Live</span></div>
          <div class="device-item"><div class="name"><span>üöó</span> Garage</div><span class="badge on">Closed</span></div>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
  const API = window.location.hostname === 'localhost'
    ? 'http://localhost:3000'
    : `http://${window.location.hostname}:3000`;
  const WS_URL = `ws://${window.location.hostname}:3001`;

  let devices = {};
  let selectedLightId = null; // null = all lights

  // --- Clock ---
  function updateClock() {
    const now = new Date();
    const h = now.getHours().toString().padStart(2,'0');
    const m = now.getMinutes().toString().padStart(2,'0');
    const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
    const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    document.getElementById('clock').textContent =
      `${h}:${m} ‚Äî ${days[now.getDay()]}, ${months[now.getMonth()]} ${now.getDate()}`;
  }
  updateClock();
  setInterval(updateClock, 10000);

  // --- Render lights ---
  function renderLights() {
    const grid = document.getElementById('lightsGrid');
    const lightDevices = Object.values(devices).filter(d => d.type === 'light');

    if (lightDevices.length === 0) {
      grid.innerHTML = `<div style="color:var(--muted);font-size:12px;grid-column:span 4;padding:10px 0">No lights found</div>`;
      return;
    }

    grid.innerHTML = lightDevices.map(device => {
      const isOn = device.state === 'ON';
      const brightness = device.brightness ? Math.round((device.brightness / 254) * 100) : 0;
      const c = device.color || { r: 255, g: 200, b: 80 };
      const colorStyle = isOn ? `rgb(${c.r},${c.g},${c.b})` : '#3a3a4a';
      const isSelected = selectedLightId === device.id;
      return `
        <div class="light-card ${isOn ? 'on' : ''} ${isSelected ? 'selected-card' : ''}"
             data-id="${device.id}"
             onclick="selectLight('${device.id}')"
             style="${isSelected ? 'border-color: var(--accent)' : ''}">
          <span class="light-icon">üí°</span>
          <div class="light-color-dot" style="background: ${colorStyle}"></div>
          <div class="room">${device.name}</div>
          <div class="status">${isOn ? `On ¬∑ ${brightness}%` : 'Off'}</div>
        </div>
      `;
    }).join('');
  }

  // --- Select light (click card to focus controls on it) ---
  function selectLight(id) {
    if (selectedLightId === id) {
      // Deselect ‚Äî tap again to toggle
      toggleLight(id);
    } else {
      selectedLightId = id;
      const device = devices[id];
      document.getElementById('selectedLightLabel').textContent = device ? device.name : 'All lights';

      // Sync brightness slider to this light
      if (device && device.brightness) {
        const pct = Math.round((device.brightness / 254) * 100);
        const slider = document.getElementById('brightnessSlider');
        slider.value = pct;
        document.getElementById('brightnessVal').textContent = pct + '%';
        slider.style.background = `linear-gradient(to right, var(--accent) ${pct}%, var(--surface2) ${pct}%)`;
      }
      renderLights();
    }
  }

  // --- Toggle light ---
  async function toggleLight(id) {
    const device = devices[id];
    if (!device) return;
    const newState = device.state === 'ON' ? 'OFF' : 'ON';
    try {
      await fetch(`${API}/devices/${id}/command`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ state: newState })
      });
    } catch (e) { console.error('Toggle failed', e); }
  }

  // --- Send colour to selected light(s) ---
  async function sendColor(r, g, b) {
    const targets = selectedLightId
      ? [selectedLightId]
      : Object.values(devices).filter(d => d.type === 'light' && d.state === 'ON').map(d => d.id);

    for (const id of targets) {
      await fetch(`${API}/devices/${id}/command`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ color: { r, g, b } })
      });
    }
  }

  // --- Colour swatches ---
  document.querySelectorAll('.swatch').forEach(swatch => {
    swatch.addEventListener('click', () => {
      document.querySelectorAll('.swatch').forEach(s => s.classList.remove('active'));
      swatch.classList.add('active');
      const r = parseInt(swatch.dataset.r);
      const g = parseInt(swatch.dataset.g);
      const b = parseInt(swatch.dataset.b);
      sendColor(r, g, b);
    });
  });

  // --- Custom colour picker ---
  const customColor = document.getElementById('customColor');
  let colorPickerTimer = null;

  customColor.addEventListener('input', () => {
    document.querySelectorAll('.swatch').forEach(s => s.classList.remove('active'));
    clearTimeout(colorPickerTimer);
    colorPickerTimer = setTimeout(() => {
      const hex = customColor.value;
      const r = parseInt(hex.slice(1,3), 16);
      const g = parseInt(hex.slice(3,5), 16);
      const b = parseInt(hex.slice(5,7), 16);
      sendColor(r, g, b);
    }, 200);
  });

  // --- Brightness slider ---
  const slider = document.getElementById('brightnessSlider');
  const brightnessVal = document.getElementById('brightnessVal');
  let lastSentBrightness = null;
  let brightnessRafPending = false;

  async function sendBrightness(val) {
    const targets = selectedLightId
      ? [selectedLightId]
      : Object.values(devices).filter(d => d.type === 'light' && d.state === 'ON').map(d => d.id);
    for (const id of targets) {
      await fetch(`${API}/devices/${id}/command`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ brightness: parseInt(val) })
      });
    }
  }

  slider.addEventListener('input', () => {
    const val = slider.value;
    brightnessVal.textContent = val + '%';
    slider.style.background = `linear-gradient(to right, var(--accent) ${val}%, var(--surface2) ${val}%)`;

    // Throttle via requestAnimationFrame ‚Äî sends on every frame while dragging
    // but never more than once per frame (~60fps), preventing API flooding
    if (!brightnessRafPending) {
      brightnessRafPending = true;
      requestAnimationFrame(() => {
        brightnessRafPending = false;
        if (val !== lastSentBrightness) {
          lastSentBrightness = val;
          sendBrightness(val);
        }
      });
    }
  });

  // --- Stats ---
  function updateStats() {
    const all = Object.values(devices);
    const lights = all.filter(d => d.type === 'light');
    const active = lights.filter(d => d.state === 'ON').length;
    const avgBrightness = active > 0
      ? Math.round(lights.filter(d => d.state === 'ON').reduce((sum, d) => sum + Math.round((d.brightness / 254) * 100), 0) / active)
      : 0;
    document.getElementById('statActive').innerHTML = `${active}<span> on</span>`;
    document.getElementById('statBrightness').innerHTML = `${avgBrightness}<span>%</span>`;
    document.getElementById('statTotal').innerHTML = `${all.length}<span> total</span>`;
    document.getElementById('statApi').textContent = '‚óè Live';
    document.getElementById('statApi').style.color = 'var(--green)';
    document.getElementById('activeCount').textContent = `${active} light${active !== 1 ? 's' : ''} on`;
  }

  // --- Fetch devices ---
  async function fetchDevices() {
    try {
      const res = await fetch(`${API}/devices`);
      const data = await res.json();
      devices = {};
      data.forEach(d => devices[d.id] = d);
      renderLights();
      updateStats();
      setApiStatus(true);
    } catch (e) { setApiStatus(false); }
  }

  // --- API status ---
  function setApiStatus(ok) {
    document.getElementById('connDot').className = 'connection-dot' + (ok ? ' connected' : '');
    document.getElementById('connLabel').textContent = ok ? 'Connected' : 'Disconnected';
    document.getElementById('apiStatusRow').className = 'status-row' + (ok ? ' ok' : ' err');
    document.getElementById('apiStatusText').textContent = ok ? 'API online' : 'API unreachable';
  }

  // --- WebSocket ---
  function connectWebSocket() {
    const ws = new WebSocket(WS_URL);
    ws.onmessage = (event) => {
      try {
        const { deviceId, state } = JSON.parse(event.data);
        if (devices[deviceId]) {
          devices[deviceId] = { ...devices[deviceId], ...state };
          renderLights();
          updateStats();
        }
      } catch (e) {}
    };
    ws.onclose = () => setTimeout(connectWebSocket, 3000);
    ws.onerror = () => ws.close();
  }

  // --- Scene buttons ---
  document.querySelectorAll('.scene-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.scene-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
  });

  // --- Nav ---
  document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', () => {
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      item.classList.add('active');
    });
  });

  // --- Init ---
  fetchDevices();
  connectWebSocket();
  setInterval(fetchDevices, 30000);
</script>
</body>
</html>
